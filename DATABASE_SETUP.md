# ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช - Database Setup

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุงููุดุฑูุน ูุณุชุฎุฏู **Drizzle ORM** ููุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช **PostgreSQL**.

**ูุฏุนู ุงูุจูุฆุชูู:**
- โ๏ธ **ุงูุณุญุงุจูุฉ (Cloud)**: ูุงุนุฏุฉ ุจูุงูุงุช Neon PostgreSQL (ุงูุชุฑุงุถู)
- ๐ป **ุงููุญููุฉ (Local)**: ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ูุญููุฉ ููุชุทููุฑ

> ๐ **ููุชุทููุฑ ุงููุญูู:** ุฑุงุฌุน [LOCAL_DEVELOPMENT.md](./LOCAL_DEVELOPMENT.md)

## ๐ง ุงูุฅุนุฏุงุฏ ุงูุฃููู

### 1. ุฅูุดุงุก ููู `.env`

ุฃูุดุฆ ููู `.env` ูู ุงููุฌูุฏ ุงูุฑุฆูุณู ูููุดุฑูุน (`ibex27/`) ูุฃุถู ุฑุงุจุท ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช Neon:

```env
DATABASE_URL=postgresql://neondb_owner:npg_81FTgGbhISvQ@ep-morning-union-a7vq0d6n-pooler.ap-southeast-2.aws.neon.tech/neondb?sslmode=require
```

> **ููุงุญุธุฉ:** ููู `.env` ููุฌูุฏ ูู `.gitignore` ููู ูุชู ุฑูุนู ุฅูู Git ูุญูุงูุฉ ูุนูููุงุช ุงูุงุชุตุงู.

### 2. ุชุซุจูุช ุงููุชุทูุจุงุช

```bash
npm install
```

ุณูุชู ุชุซุจูุช `dotenv`` ุชููุงุฆูุงู ููุฑุงุกุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ.

## ๐๏ธ ุฃูุงูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุชุทุจูู ุงููุฎุทุท (Schema) ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
npm run db:push
```

**ูุงุฐุง ููุนู:**
- ูุทุจู ุฌููุน ุงูุชุบููุฑุงุช ูู `schema.ts` ูุจุงุดุฑุฉ ุนูู ูุงุนุฏุฉ ุจูุงูุงุช Neon
- ููุดุฆ ุงูุฌุฏุงูู ูุงูุนูุงูุงุช ูุงููููุฏ
- **โ๏ธ ุชุญุฐูุฑ:** ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ููุฌูุฏุฉุ ูุฏ ูุทูุจ ูุทุน ุจุนุถ ุงูุฌุฏุงูู

### ุชูููุฏ ูููุงุช Migration

```bash
npm run db:generate
```

**ูุชู ุชุณุชุฎุฏูู:**
- ุจุนุฏ ุชุนุฏูู `schema.ts`
- ูุฅูุดุงุก ูููุงุช SQL migrations ูู ูุฌูุฏ `drizzle/`

### ูุชุญ Drizzle Studio (ูุงุฌูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช)

```bash
npm run db:studio
```

**ูุงุฐุง ููุนู:**
- ููุชุญ ูุงุฌูุฉ ููุจ ูุชุตูุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูููุฏ ููุชุญูู ูู ุงูุจูุงูุงุช ูุงูุฌุฏุงูู

### ูุญุต ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ

```bash
npm run db:check-tables
```

**ูุงุฐุง ููุนู:**
- ูุนุฑุถ ุฌููุน ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช Neon
- ูุนุฑุถ ุนุฏุฏ ุงูุตููู ูู ุงูุฌุฏุงูู ุงููููุฉ

### ุชุญุถูุฑ ุงูุจูุงูุงุช ูุจู Migration

```bash
npm run db:prepare
```

**ูุชู ุชุณุชุฎุฏูู:**
- ูุจู `db:push` ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ููุฌูุฏุฉ
- ูุตูุญ ููู NULL ููุถูู `store_id` ููุฌุฏุงูู ุงููุฏููุฉ

## ๐ ุงููููุงุช ุงููููุฉ

### `drizzle.config.ts`
- ุฅุนุฏุงุฏุงุช Drizzle Kit
- ูุณุชุฎุฏู `process.env.DATABASE_URL` ูู ููู `.env`

### `src/main/schema.ts`
- ุชุนุฑูู ุฌููุน ุงูุฌุฏุงูู ูุงูุนูุงูุงุช
- ุงููุฎุทุท ุงููุงูู ููุงุนุฏุฉ ุงูุจูุงูุงุช

### `src/main/db.ts`
- ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณู
- ูุณุชุฎุฏู `process.env.DATABASE_URL`

### `drizzle/`
- ูุฌูุฏ ูููุงุช Migration SQL
- ูุชู ุฅูุดุงุคูุง ุชููุงุฆูุงู ุนูุฏ ุชุดุบูู `db:generate`

## โ ุงูุชุญูู ูู ุงูุงุชุตุงู

### 1. ุชุญูู ูู ููู `.env`
```bash
# ุชุฃูุฏ ูู ูุฌูุฏ ุงูููู
cat .env  # Linux/Mac
type .env  # Windows
```

### 2. ุชุญูู ูู ุงูุฌุฏุงูู
```bash
npm run db:check-tables
```

### 3. ุงุฎุชุจุฑ ุงูุงุชุตุงู
```bash
npm run dev
# ุงุจุญุซ ุนู ุฑุณุงูุฉ "โ Database connection initialized"
```

## ๐ ุงูุฃูุงู

- โ ููู `.env` ููุฌูุฏ ูู `.gitignore`
- โ ูุนูููุงุช ุงูุงุชุตุงู ูุญููุฉ ููุง ุชูุฑูุน ุฅูู Git
- โ ุงุณุชุฎุฏู `.env.example` ููุงูุจ (ุจุฏูู ูุนูููุงุช ุญุณุงุณุฉ)

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "DATABASE_URL is not set"
**ุงูุญู:** ุชุฃูุฏ ูู ูุฌูุฏ ููู `.env` ูู ุงููุฌูุฏ ุงูุฑุฆูุณู ูุน `DATABASE_URL`

### ุฎุทุฃ: "Connection refused"
**ุงูุญู:** 
1. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
2. ุชุญูู ูู ุตุญุฉ ุฑุงุจุท Neon ูู `.env`
3. ุชุฃูุฏ ูู ุฃู ูุงุนุฏุฉ ุจูุงูุงุช Neon ูุดุทุฉ

### ุฎุทุฃ: "relation does not exist"
**ุงูุญู:** ุดุบูู `npm run db:push` ูุฅูุดุงุก ุงูุฌุฏุงูู

---

**๐ ููุงุญุธุฉ:** ุฌููุน ุงููููุงุช ุงูุขู ุชุณุชุฎุฏู `process.env.DATABASE_URL` ูู ููู `.env` ุจุฏูุงู ูู ุงูููู ุงููุจุงุดุฑุฉ.

