# Hybrid Architecture - ุฏููู ุงูุจููุฉ ุงููุฌููุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ุจููุฉ ูุฌููุฉ (Hybrid Architecture) ุชุฌูุน ุจูู:
- **SQLite (ุงููุญูู)**: ูุงุนุฏุฉ ุจูุงูุงุช ูุญููุฉ ูููุงุดูุฑ ุชุนูู ุจุฏูู ุฅูุชุฑูุช
- **Neon PostgreSQL (ุงูุณุญุงุจู)**: ูุงุนุฏุฉ ุจูุงูุงุช ุณุญุงุจูุฉ ูููุฒุงููุฉ ูุงูุชุฎุฒูู ุงููุฑูุฒู

## ๐๏ธ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ (SQLite)

**ุงููููุงุช:**
- `src/main/schema-local.ts` - Schema ููุฌุฏุงูู ุงููุญููุฉ
- `src/main/db-local.ts` - ุงุชุตุงู SQLite

**ุงููููุน:** `data/cashier.db` (ูู ูุฌูุฏ ุงููุดุฑูุน)

**ุงูุฌุฏุงูู ุงููุญููุฉ:**
- `products` - ููุชุฌุงุช ูุฎุฒูุฉ ูุญููุงู
- `sales` - ูุจูุนุงุช ูุญููุฉ (ูุจู ุงููุฒุงููุฉ)
- `sale_items` - ุนูุงุตุฑ ุงููุจูุนุงุช
- `customers` - ุนููุงุก ูุฎุฒููู ูุญููุงู
- `sync_queue` - ูุงุฆูุฉ ุงูุชุธุงุฑ ุงููุฒุงููุฉ
- `store_info` - ูุนูููุงุช ุงููุชุฌุฑ ุงููุฎุฒูุฉ ูุญููุงู

### 2. ุฎุฏูุฉ ุงููุฒุงููุฉ (Sync Service)

**ุงููููุงุช:**
- `src/main/sync-service.ts` - ููุทู ุงููุฒุงููุฉ
- `src/main/sync-handlers.ts` - IPC handlers

**ุงููุธุงุฆู:**

#### `syncAll(storeId)`
ูุฒุงููุฉ ูุงููุฉ: ุณุญุจ ุงูููุชุฌุงุช ูุงูุนููุงุก ูู ุงูุณุญุงุจุฉ + ุฏูุน ุงููุจูุนุงุช ุฅูู ุงูุณุญุงุจุฉ

#### `quickSync(storeId)`
ูุฒุงููุฉ ุณุฑูุนุฉ: ุฏูุน ุงููุจูุนุงุช ุงููุนููุฉ ููุท

#### `getSyncStatus(storeId)`
ุงูุญุตูู ุนูู ุญุงูุฉ ุงููุฒุงููุฉ (ุขุฎุฑ ูุฒุงููุฉุ ุนุฏุฏ ุงููุจูุนุงุช ุงููุนููุฉุ ุญุงูุฉ ุงูุงุชุตุงู)

## ๐ ุชุฏูู ุงูุนูู

### ุนูุฏ ูุฌูุฏ ุฅูุชุฑูุช:
1. ุงููุงุดูุฑ ูุนูู ุนูู SQLite ุงููุญูู (ุณุฑูุน)
2. ุงููุจูุนุงุช ุชูุณุฌู ูุญููุงู ูุน `sync_status = 'pending'`
3. ุนูุฏ ุชููุฑ ุงูุงุชุตุงูุ ูุชู ุฏูุน ุงููุจูุนุงุช ุชููุงุฆูุงู ุฅูู Neon
4. ูุชู ุณุญุจ ุฃุญุฏุซ ุงูููุชุฌุงุช ูุงูุนููุงุก ูู Neon

### ุนูุฏ ุนุฏู ูุฌูุฏ ุฅูุชุฑูุช:
1. ุงููุงุดูุฑ ูุนูู ุจุงููุงูู ุนูู SQLite ุงููุญูู
2. ุฌููุน ุงููุจูุนุงุช ุชูุณุฌู ูุญููุงู
3. ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงูุ ูุชู ุงููุฒุงููุฉ ุชููุงุฆูุงู

## ๐ก ุงุณุชุฎุฏุงู IPC Handlers

### ูู Renderer Process:

```typescript
// ูุฒุงููุฉ ูุงููุฉ
const result = await window.electron.ipcRenderer.invoke('sync:full', storeId);
// result: { success: boolean, pulled: number, pushed: number, errors: string[] }

// ูุฒุงููุฉ ุณุฑูุนุฉ (ุฏูุน ููุท)
const result = await window.electron.ipcRenderer.invoke('sync:quick', storeId);

// ุงูุญุตูู ุนูู ุญุงูุฉ ุงููุฒุงููุฉ
const status = await window.electron.ipcRenderer.invoke('sync:status', storeId);
// status: { lastSyncAt: Date | null, pendingSales: number, isOnline: boolean }
```

## ๐ง ุงูุฅุนุฏุงุฏุงุช

### 1. ุฅุตูุงุญ drizzle.config.ts

ุชู ุฅุตูุงุญ ููู `drizzle.config.ts` ููุฑุงุกุฉ `.env` ุจุดูู ุตุญูุญ ุญุชู ูู PowerShell:

- ููุฑุฃ `.env` ูุฏููุงู ุฃููุงู
- ุซู ูุณุชุฎุฏู `dotenv` ูุงุญุชูุงุทู
- ูุนูู ุจุฏูู ุงูุญุงุฌุฉ ูุชุนููู `DATABASE_URL` ูุฏููุงู ูู Terminal

### 2. Multi-Store Support

ุฌููุน ุงููููุงุช ุงูุฑุฆูุณูุฉ ุชุฏุนู ุงูุขู ููุชุฑุฉ ุงูุจูุงูุงุช ุจูุงุกู ุนูู `storeId`:

- โ `inventory.ts` - ุงูููุชุฌุงุช
- โ `sales.ts` - ุงููุจูุนุงุช
- โ `expenses.ts` - ุงููุตุฑููุงุช
- โ `due_payments.ts` - ุงูุฏููู
- โ `rents.ts` - ุงูุฅูุฌุงุฑุงุช
- โ `hr.ts` - ุงูุญุถูุฑ ูุงูุฑูุงุชุจ
- โ `reports.ts` - ุงูุชูุงุฑูุฑ

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุชุซุจูุช ุงููุชุทูุจุงุช

```bash
npm install
```

### 2. ุชุดุบูู ุงูุชุทุจูู

```bash
npm run dev
```

### 3. ุงููุฒุงููุฉ ุงููุฏููุฉ

ูู ูุงุฌูุฉ ุงููุณุชุฎุฏูุ ููููู:
- ุชุดุบูู ูุฒุงููุฉ ูุงููุฉ ุนูุฏ ุจุฏุก ุงูููู
- ุชุดุบูู ูุฒุงููุฉ ุณุฑูุนุฉ ุจุนุฏ ูู ูุฌููุนุฉ ูุจูุนุงุช
- ูุฑุงูุจุฉ ุญุงูุฉ ุงููุฒุงููุฉ ูู ุงูููุช ุงููุนูู

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃูุงู**: ุฌููุน ุงูุนูููุงุช ุงููุญููุฉ ูุญููุฉ ุจู Foreign Keys ู Transactions
2. **ุงูุฃุฏุงุก**: SQLite ุณุฑูุน ุฌุฏุงู ููุนูููุงุช ุงููุญููุฉ
3. **ุงูููุซูููุฉ**: ุงููุฒุงููุฉ ุชุนูู ุจุดูู ุขูู ูุน ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
4. **ุงูุชูุงูู**: ุงููุธุงู ูุนูู ูุน ุฃู ุจุฏูู ุฅูุชุฑูุช

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: ุงููุฒุงููุฉ ูุง ุชุนูู
- ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
- ุชุญูู ูู `DATABASE_URL` ูู `.env`
- ุฑุงุฌุน ุณุฌูุงุช Console ููุฃุฎุทุงุก

### ูุดููุฉ: ูุงุนุฏุฉ ุจูุงูุงุช SQLite ูุง ุชููุดุฃ
- ุชุญูู ูู ุตูุงุญูุงุช ุงููุชุงุจุฉ ูู ูุฌูุฏ `data/`
- ุชุฃูุฏ ูู ุชุซุจูุช `better-sqlite3` ุจุดูู ุตุญูุญ

### ูุดููุฉ: ุงููุจูุนุงุช ูุง ุชูุฏูุน
- ุชุญูู ูู `sync_status` ูู ุฌุฏูู `sales` ุงููุญูู
- ุฑุงุฌุน `sync_queue` ููุฃุฎุทุงุก
- ุฌุฑุจ ูุฒุงููุฉ ูุฏููุฉ

## ๐ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

- `src/main/db.ts` - ุงุชุตุงู Neon (ุงูุณุญุงุจู)
- `src/main/db-local.ts` - ุงุชุตุงู SQLite (ุงููุญูู)
- `src/main/sync-service.ts` - ููุทู ุงููุฒุงููุฉ
- `src/main/schema.ts` - Schema ุงูุณุญุงุจู (PostgreSQL)
- `src/main/schema-local.ts` - Schema ุงููุญูู (SQLite)

